## 개념

- 엔티티를 영구 저장하는 환경
- 애플리케이션과 데이터베이스 사이에서 객체를 보관하는 가상의 데이터 베이스 같은 역할을 함
- 엔티티 매니저가 엔티티 저장 및 조회하는 역할을 하는데, 이를 영속성 컨텍스트에 보관하고 관리

## 특징

- 엔티티 매니저를 생성할 때 하나 만들어짐
- 엔티티 매니저를 통해서 영속성 컨텍스트에 접근하고 관리 가능
- 영속성 컨텍스트는 엔티티를 식별자 값으로 구분한다. 따라서 영속상태는 식별자 값이 반드시 필요
- JPA는 보통 트랜잭션을 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영 (flush)

## 장점

- 1차캐시
    - 영속성 컨텍스트 내부에 캐시가 존재. 1차 캐시에 엔티티가 없으면 데이터베이스에서 조회해와서 1차캐시에 저장하고, 엔티티가 있으면 바로 1차캐시의 값을 반환.
    - 빠른 조회 가능
- 영속성 엔티티의 동일성 보장
    - 동일 트랜잭션 내 엔티티의 동일성은 Repeatable Read 수준의 트랜잭션 격리 수준이 보장됨
- 쓰기 지연(transactional write-behind)
    - commit 직전까지 insert, update, delete 쿼리를 수행하지 않음
    - 내부 쓰기 지연 SQL 저장소에 수행할 쿼리를 모아두고 commit 시점에 한꺼번에 SQL문 DB에 전달
    - 한번에 쿼리 전달하므로 성능 최적화를 할 수 있음
- 변경 감지(dirty checking)
    - 영속성 컨텍스트에 저장된 객체의 멤버 값을 변경하면 데이터 베이스의 데이터가 변경(flush)되는데, 이는 변경 감지 기능 때문에 가능
    - 영속성 컨텍스트에 저장된 엔티티들의 변경사항 감지
    - 지속적으로 바뀌는 비즈니스 요건 사항을 따라 매번 SQL 변경하지 않아도 데이터 베이스에 자동으로 반영(flush)